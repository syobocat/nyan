<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>にゃん語ジェネレーター ver.1.2</title>
  </head>
  <body>
    <textarea id="input" name="input" cols="200" rows="20" placeholder="入力"></textarea><br />
    <div class="options">
      <label for="bunmatsu">文末</label>
      <select id="bunmatsu" class="bunmatsu">
        <option value="にゃ" selected>にゃ</option>
        <option value="にゃん">にゃん</option>
        <option value="other">その他</option>
      </select>
      <input type="text" id="other" value="にゃ">
      <div class="nyaoptions">
        <input type="checkbox" id="nai_to_nyai">
        <label for="nai_to_nyai">「ない」を「にゃい」に変換</label>
      </div>
      <button onclick="On_Click()">変換</button>
    </div>
    <textarea readonly id="output" name="output" cols="200" rows="20" placeholder="出力"></textarea><br />

    <!--ここから内部処理-->
    <script src="./pkg/nyan_genelator.js"></script>
    <script>
      var otherinput = document.getElementById("other");
      var nyaoptions = document.getElementsByClassName("nyaoptions")[0];

      otherinput.style.display = "none";
      document.addEventListener('DOMContentLoaded', function() {
        var bunmatsu = document.getElementsByClassName("bunmatsu");
        bunmatsu[0].onchange = function() {  
          if (this.value == "other") {
            nyaoptions.getElementById("nai_to_nyai").checked = false;
            otherinput.style.display = 'inline';
            nyaoptions.style.display = 'none';
          } else {
            otherinput.value = this.value;
            otherinput.style.display = 'none';
            nyaoptions.style.display = 'block';
          }
        }
      });

      const { translate } = wasm_bindgen;
      async function On_Click() {
        await wasm_bindgen('./pkg/nyan_genelator_bg.wasm');
        const original = document.getElementById("input").value;
        const replacer = document.getElementById("other").value;
        document.getElementById("output").value = translate(original, replacer, document.getElementById("nai_to_nyai").checked);
      }
    </script>
  </body>
</html>
